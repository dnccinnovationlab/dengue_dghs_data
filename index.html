<!DOCTYPE html>
<html>
<head>
  <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
</head>
<body>

<script>
(function() {
    var myConnector = tableau.makeConnector();

    myConnector.getSchema = function(schemaCallback) {
        var cols = [
            { id: "date", dataType: tableau.dataTypeEnum.date },
            { id: "affected", dataType: tableau.dataTypeEnum.int },
            { id: "death", dataType: tableau.dataTypeEnum.int },
            { id: "dncc_case", dataType: tableau.dataTypeEnum.int },
            { id: "dncc_death", dataType: tableau.dataTypeEnum.int },
            { id: "dscc_case", dataType: tableau.dataTypeEnum.int },
            { id: "dscc_death", dataType: tableau.dataTypeEnum.int },
            { id: "dhaka_case", dataType: tableau.dataTypeEnum.int },
            { id: "dhaka_death", dataType: tableau.dataTypeEnum.int }
        ];

        var tableSchema = {
            id: "dengue_dghs_data",
            alias: "DGHS Dengue Dashboard CSV",
            columns: cols
        };

        schemaCallback([tableSchema]);
    };

    myConnector.getData = function(table, doneCallback) {
        var url = "https://raw.githubusercontent.com/dnccinnovationlab/dengue-dashboard/refs/heads/main/daily_dengue_dghs.csv";

        fetch(url)
            .then(res => res.text())
            .then(text => {
                var rows = tableau.csvToTable(text);
                table.appendRows(rows);
                doneCallback();
            });
    };

    tableau.registerConnector(myConnector);
})();
</script>

<h2>DGHS Dengue Data</h2>
<button onclick="tableau.connectionName='DGHS CSV'; tableau.submit();">
    Load Data
</button>

</body>
</html>
